{% extends 'base.html.twig' %}
{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                {{ form_start(form) }}
                {{ form_row(form.title) }}
                {{ form_row(form.slug) }}
                {{ form_row(form.content) }}
                {{ form_row(form.image) }}
                {{ form_row(form.price) }}
                <div class="d-flex flex-row mb-2">
                    <h3 class="p-2">Gallery</h3>
                    <button type="button" class="add_item_link p-2 btn btn-primary" data-collection-holder-class="gallery">Add Image</button>
                </div>
                <ul class="gallery"
                    data-index="{{ form.gallery|length > 0 ? form.gallery|last.vars.name + 1 : 0 }}"
                    data-prototype="{{ form_row(form.gallery.vars.prototype)|e('html_attr') }}"
                >
                    {% if form.gallery|length >0 %}
                        {% for ga in form.gallery %}
                            <li>{{ form_row(ga) }}</li>
                        {% endfor %}
                    {% endif %}
                </ul>
                <button type="submit" class="btn btn-primary">Save</button>
                {{ form_end(form) }}
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% set id = 'service_form_content' %}
    {% include 'common/ckeditor.html.twig' %}
    <script type="application/javascript">
        const addTagFormDeleteLink = (item) => {
            const removeFormButton = document.createElement('button');
            removeFormButton.innerText = 'Delete this Image';
            removeFormButton.className = 'btn btn-danger mb-2';
            item.append(removeFormButton);

            removeFormButton.addEventListener('click', (e) => {
                e.preventDefault();
                // remove the li for the tag form
                item.remove();
            });
        };
        const addFormToCollection = (e) => {
            const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

            const item = document.createElement('li');

            item.innerHTML = collectionHolder
                .dataset
                .prototype
                .replace(
                    /__name__/g,
                    collectionHolder.dataset.index
                );

            collectionHolder.appendChild(item);
            addTagFormDeleteLink(item);

            collectionHolder.dataset.index++;
        };
        window.onload = function(){
            document
                .querySelectorAll('.add_item_link')
                .forEach(btn => {
                    btn.addEventListener("click", addFormToCollection)
                });
            document
                .querySelectorAll('ul.gallery li')
                .forEach((tag) => {
                    addTagFormDeleteLink(tag)
                })
        }
    </script>
{% endblock %}
